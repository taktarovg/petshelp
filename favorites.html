<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–º–æ—â—å–ñ–∏–≤–æ—Ç–Ω—ã–º - –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</title>
    <link rel="stylesheet" href="css/styles.css?v=1.1">
</head>
<body>
    <div class="app">
        <div class="header">
            <h1>‚ù§Ô∏è –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</h1>
        </div>

        <div class="content">
            <div id="favorites-list">
                <!-- Favorite items will be inserted here -->
            </div>
            
            <div class="empty-state" id="empty-favorites" style="display: none;">
                <div style="font-size: 48px; margin-bottom: 16px;">üíú</div>
                <div>–ü–æ–∫–∞ –Ω–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –∑–∞—è–≤–æ–∫</div>
                <div style="margin-top: 8px; font-size: 12px;">–î–æ–±–∞–≤–ª—è–π—Ç–µ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –∑–∞—è–≤–∫–∏, —á—Ç–æ–±—ã –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å –∏—Ö</div>
                <div style="margin-top: 16px;">
                    <a href="index.html" class="btn">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞—è–≤–∫–∏</a>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <a href="index.html" class="nav-item">
                <span class="nav-icon">üìã</span>
                <span class="nav-label">–õ–µ–Ω—Ç–∞</span>
            </a>
            <a href="favorites.html" class="nav-item active">
                <span class="nav-icon">‚ù§Ô∏è</span>
                <span class="nav-label">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
            </a>
            <button class="fab" onclick="openCreateModal()">+</button>
            <a href="catalog.html" class="nav-item">
                <span class="nav-icon">üè¢</span>
                <span class="nav-label">–ö–∞—Ç–∞–ª–æ–≥</span>
            </a>
            <a href="profile.html" class="nav-item">
                <span class="nav-icon">üë§</span>
                <span class="nav-label">–ü—Ä–æ—Ñ–∏–ª—å</span>
            </a>
        </div>
    </div>

    <!-- Detail Modal -->
    <div id="detailModal" class="modal detail-modal">
        <div class="modal-content">
            <div class="modal-header">
                <button class="back-btn" onclick="closeDetailModal()">‚Üê</button>
                <h2 class="modal-title">–î–µ—Ç–∞–ª–∏ –∑–∞—è–≤–∫–∏</h2>
            </div>
            <div id="detailContent">
                <!-- Detail content will be inserted here -->
            </div>
        </div>
    </div>

    <script src="js/common.js?v=1.1"></script>
    <script>
        // Favorites page specific functionality
        function renderFavorites() {
            const favoritesList = document.getElementById('favorites-list');
            const emptyState = document.getElementById('empty-favorites');
            const favoriteRequests = getFavoriteRequests();
            
            if (favoriteRequests.length === 0) {
                favoritesList.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            favoritesList.innerHTML = favoriteRequests.map(request => `
                <div class="favorite-item">
                    <div class="card-image">
                        ${request.image && !request.image.includes('data:image/svg') ? 
                            `<img src="${request.image}" alt="–§–æ—Ç–æ">` : 
                            getAnimalEmoji(request.helpType)}
                    </div>
                    <div class="favorite-content" onclick="openDetailModal(${request.id})">
                        <div class="favorite-title">${request.title}</div>
                        <div class="favorite-meta">
                            üìç ${getCityText(request.city)} ‚Ä¢ ${getHelpTypeText(request.helpType)} ‚Ä¢ ${request.time}
                        </div>
                        <div style="margin-top: 4px; font-size: 12px; color: var(--tg-theme-hint-color);">
                            ${request.description.substring(0, 80)}${request.description.length > 80 ? '...' : ''}
                        </div>
                    </div>
                    <button class="remove-favorite" onclick="removeFavorite(${request.id})" title="–£–±—Ä–∞—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ">
                        √ó
                    </button>
                </div>
            `).join('');
        }

        function removeFavorite(id) {
            toggleFavorite(id);
            renderFavorites();
            alert('–ó–∞—è–≤–∫–∞ —É–¥–∞–ª–µ–Ω–∞ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ');
        }

        function openDetailModal(id) {
            const request = helpRequests.find(req => req.id === id);
            if (!request) return;
            
            const modal = document.getElementById('detailModal');
            const content = document.getElementById('detailContent');
            
            content.innerHTML = `
                ${request.image && !request.image.includes('data:image/svg') ? 
                    `<img src="${request.image}" alt="–§–æ—Ç–æ" class="detail-image">` : 
                    `<div style="height: 200px; background: var(--tg-theme-secondary-bg-color); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 64px; margin-bottom: 16px;">
                        ${getAnimalEmoji(request.helpType)}
                    </div>`
                }
                <div class="detail-urgency ${request.urgency}">${getUrgencyText(request.urgency)}</div>
                <h3>${request.title}</h3>
                <div style="margin: 12px 0; color: var(--tg-theme-hint-color); font-size: 14px;">
                    üìç ${getCityText(request.city)} ‚Ä¢ ${getHelpTypeText(request.helpType)} ‚Ä¢ ${request.time}
                </div>
                <div style="margin: 16px 0; line-height: 1.4;">
                    ${request.description}
                </div>
                <div style="margin: 16px 0; padding: 12px; background: var(--tg-theme-secondary-bg-color); border-radius: 8px;">
                    <strong>–ö–æ–Ω—Ç–∞–∫—Ç:</strong> ${request.contact}<br>
                    <strong>–ê–≤—Ç–æ—Ä:</strong> ${request.author}
                </div>
                <div class="detail-actions">
                    <button class="btn" onclick="contactHelper('${request.contact}')">–°–≤—è–∑–∞—Ç—å—Å—è</button>
                    <div style="display: flex; gap: 8px; margin-top: 12px;">
                        <button class="btn btn-secondary" onclick="toggleFavoriteFromModal(${id})" style="flex: 1;">
                            üíî –£–±—Ä–∞—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
                        </button>
                    </div>
                    <div class="share-buttons">
                        <button class="share-btn" onclick="shareToStory(${id})">üì± –í —Å—Ç–æ—Ä–∏—Å</button>
                        <button class="share-btn" onclick="shareToChat(${id})">üí¨ –í —á–∞—Ç</button>
                        <button class="share-btn" onclick="copyLink(${id})">üîó –°—Å—ã–ª–∫–∞</button>
                    </div>
                </div>
            `;
            
            modal.style.display = 'block';
        }

        function closeDetailModal() {
            document.getElementById('detailModal').style.display = 'none';
        }

        function toggleFavoriteFromModal(id) {
            toggleFavorite(id);
            closeDetailModal();
            renderFavorites();
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            renderFavorites();

            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
                const detailModal = document.getElementById('detailModal');
                if (event.target === detailModal) {
                    closeDetailModal();
                }
            });
        });
    </script>
</body>
</html>